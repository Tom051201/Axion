#include "axpch.h"
#include "Buffers.h"

#include "Renderer.h"

#include "platform/directx/D12Buffers.h"

namespace Axion {

	////////////////////////////////////////////////////////////////////////////////
	///// BufferElement ////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////



	////////////////////////////////////////////////////////////////////////////////
	///// BufferLayout /////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////

	void BufferLayout::calculateOffsetAndStride() {
		uint32_t offset = 0;
		m_stride = 0;

		for (auto& element : m_elements) {
			element.offset = offset;
			offset += element.size;
			m_stride += element.size;
		}
	}

	////////////////////////////////////////////////////////////////////////////////
	///// VertexBuffer /////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////

	VertexBuffer* VertexBuffer::create(const std::vector<Vertex>& vertices) {

		switch (Renderer::getAPI()) {
			
			case RendererAPI::API::None: { AX_ASSERT(false, "None is not supported yet"); return nullptr; }
			case RendererAPI::API::Direct3D12: { return new D12VertexBuffer(vertices); }

		}
		return nullptr;
	}

	////////////////////////////////////////////////////////////////////////////////
	///// IndexBuffer //////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////

	IndexBuffer* IndexBuffer::create(const std::vector<uint32_t>& indices) {
	
		switch (Renderer::getAPI()) {
			
			case RendererAPI::API::None: { AX_ASSERT(false, "None is not supported yet"); return nullptr; }
			case RendererAPI::API::Direct3D12: { return new D12IndexBuffer(indices); }
			
		}
		return nullptr;

	}

	////////////////////////////////////////////////////////////////////////////////
	///// ConstatBuffer ////////////////////////////////////////////////////////////
	////////////////////////////////////////////////////////////////////////////////

	ConstantBuffer* ConstantBuffer::create(size_t size) {
		switch (Renderer::getAPI()) {
			
			case RendererAPI::API::None: { AX_ASSERT(false, "None is not supported yet"); return nullptr; }
			case RendererAPI::API::Direct3D12: { return new D12ConstantBuffer(size); }

		}
		return nullptr;
	}

}
